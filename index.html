const questionPool = [
    { question: "What is the capital of France?", options: ["Paris", "London", "Rome", "Berlin"], answer: "Paris" },
    // Add additional questions here
];

let correctScore = 0;
let incorrectScore = 0;
let userName = "";
let usedQuestions = [];
let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];

// Start game by showing quiz container and prompting for name
function startGame() {
    document.getElementById("home-container").style.display = "none";
    askUserName();
    document.getElementById("quiz-container").style.display = "flex";
    loadQuestion();
}

// Function to navigate to home page
function goToHomePage() {
    document.getElementById("quiz-container").style.display = "none";
    document.getElementById("home-container").style.display = "flex";
    resetGame();
}

// Function to prompt for user's name
function askUserName() {
    userName = prompt("Please enter your name:");
    if (!userName) {
        userName = "Anonymous";
    }
}

// Function to load a new unique question
function loadQuestion() {
    const questionContainer = document.getElementById("question");
    const optionsContainer = document.getElementById("options");
    const resultContainer = document.getElementById("result");

    let randomIndex;
    let selectedQuestion;
    do {
        randomIndex = Math.floor(Math.random() * questionPool.length);
        selectedQuestion = questionPool[randomIndex];
    } while (usedQuestions.includes(randomIndex));

    usedQuestions.push(randomIndex);

    questionContainer.innerHTML = selectedQuestion.question;
    optionsContainer.innerHTML = "";
    resultContainer.innerHTML = "";

    selectedQuestion.options.forEach(option => {
        const button = document.createElement("button");
        button.innerHTML = option;
        button.onclick = () => checkAnswer(option, selectedQuestion.answer);
        optionsContainer.appendChild(button);
    });
}

// Function to check the answer
function checkAnswer(selectedOption, correctAnswer) {
    const resultContainer = document.getElementById("result");
    if (selectedOption === correctAnswer) {
        resultContainer.innerHTML = "<p style='color: limegreen;'>Correct!</p>";
        correctScore++;
    } else {
        resultContainer.innerHTML = "<p style='color: tomato;'>Incorrect. The correct answer is " + correctAnswer + ".</p>";
        incorrectScore++;
    }

    updateScore();

    if (incorrectScore >= 3) {
        showFinalScore();
    } else {
        setTimeout(loadQuestion, 1000);
    }
}

// Function to update the score display
function updateScore() {
    document.getElementById("correct-score").innerText = correctScore;
    document.getElementById("incorrect-score").innerText = incorrectScore;
}

// Function to show the final score and display options to restart, add a new user, or share results
function showFinalScore() {
    const questionContainer = document.getElementById("question");
    const optionsContainer = document.getElementById("options");
    const resultContainer = document.getElementById("result");
    const restartButton = document.getElementById("restart-btn");
    const newUserButton = document.getElementById("new-user-btn");
    const shareButton = document.getElementById("share-btn");

    questionContainer.innerHTML = "Game Over! You've reached the maximum of 3 incorrect answers.";
    optionsContainer.style.display = "none";
    resultContainer.innerHTML = `<p>Final Score: ${correctScore} Correct</p>`;

    restartButton.style.display = "block";
    newUserButton.style.display = "block";
    shareButton.style.display = "block";  // Show the Share Results button
    saveToLeaderboard();
    displayLeaderboard();
}

// Function to share results
function shareResults() {
    const message = `I scored ${correctScore} points in the Knowledge Testing Game! Can you beat my score? Try it here: [link-to-game]`;
    if (navigator.share) {
        // Web Share API for supported browsers
        navigator.share({
            title: "Knowledge Testing Game",
            text: message,
            url: window.location.href  // Share current page URL
        }).catch((error) => console.error("Error sharing", error));
    } else {
        // Fallback for unsupported browsers
        const shareText = document.createElement("textarea");
        document.body.appendChild(shareText);
        shareText.value = message;
        shareText.select();
        document.execCommand("copy");
        document.body.removeChild(shareText);
        alert("Results copied to clipboard! Share it with your friends.");
    }
}

// Function to save score to leaderboard
function saveToLeaderboard() {
    const playerScore = { name: userName, score: correctScore };
    leaderboard.push(playerScore);

    leaderboard.sort((a, b) => b.score - a.score);
    leaderboard = leaderboard.slice(0, 5);
    localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
}

// Function to display leaderboard
function displayLeaderboard() {
    const leaderboardDiv = document.getElementById("leaderboard");
    leaderboardDiv.innerHTML = leaderboard.map((entry, index) => `<p>${index + 1}. ${entry.name}: ${entry.score} points</p>`).join("");
}

// Function to toggle leaderboard visibility
function toggleLeaderboard() {
    displayLeaderboard();
    document.getElementById("leaderboard-container").style.display = "flex";
}

// Function to close the leaderboard
function closeLeaderboard() {
    document.getElementById("leaderboard-container").style.display = "none";
}

// Function to restart game for the same user
function restartGame() {
    correctScore = 0;
    incorrectScore = 0;
    usedQuestions = [];
    document.getElementById("correct-score").innerText = correctScore;
    document.getElementById("incorrect-score").innerText = incorrectScore;

    document.getElementById("options").style.display = "block";
    document.getElementById("restart-btn").style.display = "none";
    document.getElementById("new-user-btn").style.display = "none";
    document.getElementById("share-btn").style.display = "none";
    loadQuestion();
}

// Function to start a new game for a new user
function startNewUser() {
    correctScore = 0;
    incorrectScore = 0;
    usedQuestions = [];
    document.getElementById("correct-score").innerText = correctScore;
    document.getElementById("incorrect-score").innerText = incorrectScore;

    askUserName();
    document.getElementById("options").style.display = "block";
    document.getElementById("restart-btn").style.display = "none";
    document.getElementById("new-user-btn").style.display = "none";
    document.getElementById("share-btn").style.display = "none";
    loadQuestion();
}

// Resets the game state when returning to the home page
function resetGame() {
    correctScore = 0;
    incorrectScore = 0;
    usedQuestions = [];
    document.getElementById("correct-score").innerText = correctScore;
    document.getElementById("incorrect-score").innerText = incorrectScore;
}

// Initialize leaderboard on page load
window.onload = () => {
    displayLeaderboard();
};
